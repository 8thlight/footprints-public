####
# Env vars are, in order:
# DEPLOY_KEY
# CAPISTRANO_SERVER
# CAPISTRANO_DEPLOY_USER
# CAPISTRANO_DEPLOY_PATH_TO_SSH_KEY
# CAPISTRANO_STAGING_DEPLOY_TO
# AWS_ACCESS_KEY_ID
# AWS_SECRET_ACCESS_KEY

language: ruby
cache:
  bundler: true
  directories:
  - "/home/travis/.rvm"
rvm:
- 2.1.5
install: bundle install --jobs=3 --retry=3 --without deploy production
before_script:
- mysql -e 'create database footprints_test;'
- cp config/ci.database.yml config/database.yml
- cp config/mailer.yml.example config/mailer.yml
script: bundle exec rake
jobs:
  include:
  # - stage: test
  - stage: deploy
    script: skip
    deploy:
      provider: script
      script: "./travis-deploy.sh"
stages:
# - name: test
- name: deploy
  on: |
    branch IS master AND \
    env(TRAVIS_PULL_REQUEST) IS NOT true
env:
  global:
  - secure: VFPTYjs9qySaJ5eE3w63gSfpcKIfFTcR4MxgJQUB5J+uEAsuDGFXFyiJkJSEwT6Y4u46KsA+uMeQ8f9NdYpfx8EpytJ5UYZzJgo5XdmGftggy4rQHkz3FLLlHBDtJGIoVTIJIjJKb9g6IzrX/yx/YGUX34aNrOh+LaJDIDo7bLZx6TZ+1QXhIWF/t2HG8wDL0GD0gyezt5tqxiPObKFQc/XUr1fKvbdrE4sUqVa+45JaKXcfuYWDwjI0xXrEMOSBp10v/jClD17HBKOibbnTk8D5iWuJdPIWZoaRRXNGanPv80UlarEG3E7NPoss5kVc3fkrmL5r1z73LQc6CZvBOkzJ0K6Dnf+Wylw8r2nHV7D3Ek1cf/jTeVagLS23ZhvqVzHRPAuo6jA9ZemJxo7uDM7qKSIcfaPhf4WKFDaevEQHOqTCBYuQ3Xt4yj7YPFsMlfMUUm7G6ZH7t70OwpG6CCYxDdD+BeNboC60dGK5ijqGhE5FyBunO4J+ZAEThP4nsMNGjI5H2osv0J0Z46Drgskf3haXPbdTUlpGkbFhvTUt0W/B+YjDSYi60ukM7S0y2uPFPi7c4Zcm9+oUR6fJ7vDXp9ZjpR4mKbFyexpcO2yRdOgrogTJHK5iOJhpqi7wtzb0xS2N3XLjgpRDtihtDsNTlf8sij0Zz+Gfra43RR0=
  - secure: WwulkIAfi0An/2Os/PSeUbgFKy5aTNRfC7WfbUaYH+Bt0iCP5MDIxKuOSVkz2ToMls0ZiFmcw2TdHMMjTV9P5dAsPMBCZ4UxIVqk15eQcHrpzH9c5pFh/UK1J6wwQC//mNpjSnxb+0UhdllPz+yRq4P192ajB0vsyHXCsjArGwHj3ArlN4laOrDjfVsydyPVsTXo/PatDrhapWmm2poBlqDAiajgwSMEIAkvMiYJjBmGqZohu3tiiqkTdJ/3ZOhDo+xHi5PfCcllocpEGG/TyRbdzxEJ2UnAHWmuadAIncoH36ACTRPhI/eNboxKcWPjF3P0gwbmdO1PSlv4hksj4HePIbUIdIEsA7FxgLMnlSEXMk/YTV9hKN0EY8ftrZyzjh2tTMfTmiDOVAeckMRcp2kPYfTVsGybWE+fuYIH3AIY3gWGI/87a7arBMY+Cfal1Vxzi9Q6UuV7oXGbVNIA74YXuu/rFQgfA+942z6ua5CNGAhhqCef65Kg4HlucyLyNKoq/62nVYZW9HDJczsPirHbuuSDut01XieHoqCghscRpMICc3YTTHAas7XPB9JLbBmgjIqonFHgiziGOCMq6IgpdXM7H7gNj72V8z0Dkh670ucNOQ5H41CoKqB5+lVD5laTtzi+U5VKv4sF39JHCmIY+yW3uAdjihsXLVGMgos=
  - secure: lZGr/+RGsMncmPDB4IjsKg8QctSSh2y7OjJ/Xs0DHsOmfX0BqPLedT3a//Zh+6B+uJ2PDhPRQ4qdcb58v9fX0rzzFJonqyftQuIj6vC2eHimG0MaX3OSxKZHZQ7Ylo7UBWsAAeJWQrTanihJ+RXSzIM/xi9tMjVDMQAZLbRKTL9aaCGpHzUrNKTZJndBDEiIuNgDDqeHnGkVPi9mbHF/giThK6zESniEm+FribVUdzkEuNAysZM2L7faIDNbHCv17vpnCKEwI+Bk74bKJv6PfVL/1cgpW1+sSWdtbUzxqKhlfMo/KDV+5XLM2Lrqg1e+EAauT7dcX8RiIpTouAiuBjBo8NvdV9QtBMPcO8qwwmanzoICdxImAI2rMQIMJxiyRt0U5Ucy8DLpvnwLujqlVfWXK1O0WxZDdBX30V7UKmrS5PdrScsTc13tP4ryfi80CQIqJwJF93vSYVWE4zyX2jHYN/7UCd8YZLaNcpi+tTJfoST5M4g8Jr67TUhS4sBkVNpbWgmLGbR+7Ren4K7AE//nXYYuzY57yx6cPKufckRJbKzankTH/ISjmvxHpuiYJV3SoGVHN9rVimJTa+pqXTu68AlmngKnSsrL/J6fXwGhJt3wRwKSOvnXrC70pXpOf316tBwtdSsFcBAHG8snVJuzC6wqySQWkV9ifH+55ME=
  - secure: aYx+9kQ12oC3mgJD0+UgKVk3hNAOk4U4UZ4yjcER0vDA5foyucgZFzBHTaS/JtQplUn/allEWRo3+6OUrhZzDifMCzZtLEKs2rWhBT/Qbn189E17qyz5OnuWbOgu3FHpV86yMLbLu/6zAZIDg+4uQuNnP4QD2ocQLxn/3gpC4YogcruR9EDviD7tAkz88Wb1y7Ha7rFot/qL3QL3X6nl0CmuF6hcH3AtO+lUStAvV/bQ0derEjadINtlo6+M3VL5bjzFSCQsfwbDeSNPlbK4mdTFVXd8X90yfEYEiYonNar1QKNTt5ZaJR0bl3oPngYclhBh0N9DxrR3njf0n4tnmf1kz9Qtqwo1uzX5n6/tl/JMvfFkhVQo416zf7hFudnHO2xc5MCidgnC+uJESECC+KvaUXTJRSUWYQnjKlIiEWTfxw0KBVR21kBU0Uh2AmQAo6ibOynG9RMVPzjosH9aRTNPlWW0cyL9ncBcc6T68C30AiGvJORsxQ/bFy69pLbAiNsDuNkACP+VxW6OtTk6SE4nnBETaVeWTmCKD3lEL1tGkwl9+2iquGutc9PtOX4YPPa+so+yZb+E23s2NTnX39dNAUZh0h8Soe4PqvArIEjwHJX4YQ/lG/g0bX9NGBrbtI627ICdAqJ9mWvupA4y+2R1o6XKLjnoJPErv/7Uh7o=
  - secure: Ia3ZAoFyGTS8fMEZwbUvXjeQeVyFut3PlkxtTS+XXVj9KnBK4Rb6viBWWU9Muv4pbQqcur5/HhHR7lFioXEuoUtTGkMrawFGEIP/WyeufQbiSwpF1OQyb5G2EinFctTTJhcNhHHeYVy5vwOxCpRjYwqExKS4RAKzCavOFQzINy0wDmn1LF0RXt3cA/KE0PBc5jaGaY8qRtXteAQ+Bao7S9j2K3ayzyGlU7FuQbUVP/10+1Rr7qDqdZRNTx+Yw9GY+IlAjP3IAfMyWVNcP+93aALmuYLZBhROIq64zDFHX7Lz3V6kinS8uCPQ4jUaWl9dHDry6YT6iKzzXL1pQfZdlzGrylSrkU1X+cdVEz/TienN8EBzTwPNePmVZ+NZAwGcsrgII0/PZNNJ3fdJSezfSyurHFpH9wwakVCkIhG3e/BmuHQHUfhdA0HUwMsF8yykFFUTpTWsXHqx7tlQGAxu9cpaJXNPwMnRM8aL9uKZI87BjAiZ8mlGbeNK2SvvzG8kcE0CdzjrYmZEnPEf9IQbDyGiFb7KJ4Brhur3c65bTf/Fjn87sTGJJkCAkEfn7dc2e00alqGg+U3A5TZJ5Z1NcjcPkufOV5+ukdZ7rT8u0JNeui4pxvZ2LnY2Lp96euFBB+cjcMLgRvdwP3cCWkdyjLkaR6jpz6LhGXQomGZfmok=
  - secure: AnTnCyPOPI362+b4m0FpJL9qvotiMzOiAuey5OeG9fVa6NdHN8Fbd9HnrN0RvnDUT8QvZxkjCwm4jPjwcThzqY8r205FYiLoX+Lsg1Kwn1LRvC+5/9Pcd09AvXK8rZyFkmkOdh86vr7nMBDpWv7ATQyz/FaX+g0R9zM/MUnI5/dZPK8AKspHYSN3ZQvfguhLr1xDWdiVxFXEPtw9/uBVJxaRQFHxCX1oIF7GOcfM3zg3ngTIlrpx2YEq6/te/N39IuQAmSoI9xIw5Ci9IrpFA+WR18bEubYr4uC2VKnvULjJrGd01gvbaPMV4+nWB5uAGrwGasA/a25AjX7Bv798w7eaA4OOEvisRPa6YLfi6GDFAJJNcp38zqak0TO89veGm77XYiz7zXDAiPeUAkxWeUAtoRBUZWJ9MuF/qnFH4Yr4KVK3jimfBKdT9+map4sY9ynkta/qfDy55UmMf0MV/NX6DO7n9j6WE+2QbZvV+r5UrgQGnORZOTMfgvrhvCR6ffwjNhVoL49HmnBflBKcGS60moliuueHcG6E4bE+cUJiR8Wq1bbOd721pCZ+g9opkXMzJb2rvyG4WJ8NuXbDaOn7wxYUovd8gnpYmJ/HQsl1jS9KVNDDy9eQGwMLNBe7ehjGPUqyxJ8SIn1u2zwePI9zh1izcNoAK+kSpn8BYCo=
  - secure: mDo1F/pPUien6X/ZnT8LRnR70IrX5sW1yuvg1YP4Je19X04gAE60JeCWJV4e2bSJi1ii8PKy+iI6TJ1/lfebb/Ehx2j0sDQkCGHHqjoVCOjpuCVCF5BAQQTs+5EFf2eVQwZWVajY1OvwU/6NwhHDIbp4Au08Ii19VseOk+jVRStMvReDed85K831GL0wzkqXKBA/P4RKjT+hZEy4XTPO79PUYO4NS6PqUeRpl2TlYv0kmnOw0Ean4OWBBcC0+9X6vg55m89PBfeCKGSV/kbZ8I1ATMMLeNf7a+h36NcOGdufPOBY0eiK3Mq+1maMJRSwOj6JApXcfUJxXLcey0671EIgsa5ZZHxVWnGtv/l/iXjXMnNkjmmx934924I/oYOq/BBUBK1UCKrKuObe5uUs9XGyF3KLMMcz2jPgIoRF5eAZIasTeq2mii/8CHztO1n39hRfoporS6pJ1mP7jJeHbau1oXXMCuWUVr1A1eaWmsmijqbIBXu/6cY7GMqfGHMc6Fv94Gc1O2cfAzaa6siCnYqcssuRUEimYpSCGl5V5tVBr2lM4x/lsHivpHCasnpbU3koXeB++erMc9ZPwoUWCPprsdQzLlWBsVTD70o1xp5HvTGKfxO4nFtdzo+T7VWeN6O2SnLL2s/uN7o5BxL1CCXM6jEjryrO8kUvqqes9wU=
